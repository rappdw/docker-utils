#!/usr/bin/env bash
# vim: filetype=sh:

IMAGE_NAME=${IMAGE_NAME}
if [ "$IMAGE_NAME" == "" -a "$#" -ne 1 ]
then
    echo ""
    echo "ERROR: Either IMAGE_NAME must be defined, or the mode must be provided as a single argument. e.g."
    echo "    publish-image prod"
    echo ""
    exit 1
fi

BUILD_NUMBER=${BUILD_NUMBER:-$(python -c "import versioneer; print(versioneer.get_versions()['version'].replace('+', '-'))")}
IMAGE_NAME=${IMAGE_NAME:-$(basename $(pwd))-$1}

echo -e "Pushing the image: $IMAGE_NAME:$BUILD_NUMBER"
docker tag $IMAGE_NAME $IMAGE_NAME:$BUILD_NUMBER
docker push $IMAGE_NAME:$BUILD_NUMBER

